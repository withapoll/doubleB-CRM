import{_ as Y,r as d,l as Z,u as Q,e as ss,c as i,a as s,x as F,t as n,b as u,v as m,s as D,F as g,i as x,j as v,k as c,T as L,w as $,n as p,o as a}from"./index-CbGnWNe_.js";import{s as f}from"./supabaseClient-CC64HUUu.js";const ts={class:"products-page"},os={class:"stats-row"},es={class:"stat-card"},ls={class:"stat-content"},rs={class:"stat-value"},ns={class:"stat-card"},as={class:"stat-content"},is={class:"stat-value"},ds={class:"stat-card low-stock"},us={class:"stat-content"},cs={class:"stat-value"},vs={class:"control-panel"},ms={class:"search-section"},ps=["value"],bs={class:"products-grid"},ys={class:"product-header"},fs={class:"product-category"},ks={class:"product-body"},_s={class:"product-stats"},gs={class:"stat-item"},ws={class:"product-actions"},Cs=["onClick"],hs=["onClick"],qs=["onClick"],Vs={key:0,class:"modal-overlay"},xs={class:"modal-content"},Us={class:"modal-body"},Ms={key:0,class:"product-info"},Os={class:"form-group"},Ps=["max"],Ss={class:"form-group"},Fs={key:0,class:"modal-overlay"},Ds={class:"modal-content"},Ls={class:"modal-header"},Bs={class:"modal-body"},Ts={class:"form-group"},js={key:0,class:"error-message"},Es={class:"form-group"},Is={class:"form-group"},Ns=["value"],Qs={key:0,class:"error-message"},$s={class:"form-row"},zs={class:"form-group"},As={key:0,class:"error-message"},Gs={class:"form-group"},Hs={key:0,class:"error-message"},Js={class:"form-footer"},Ks={type:"submit",class:"btn btn-primary"},Rs={key:0,class:"modal-overlay"},Ws={class:"modal-content"},Xs={class:"modal-header"},Ys={class:"modal-body"},Zs={class:"form-group"},st={key:0,class:"error-message"},tt={class:"form-group"},ot={class:"form-group"},et=["value"],lt={key:0,class:"error-message"},rt={class:"form-row"},nt={class:"form-group"},at={key:0,class:"error-message"},it={class:"form-group"},dt={key:0,class:"error-message"},ut={class:"form-footer"},ct={type:"submit",class:"btn btn-primary"},vt={__name:"ordersView",setup(mt){const w=d([]),C=d(""),h=d(""),U=d(["Напитки","Молочные продукты","Выпечка","Прочее"]),B=d(0),T=d(0),j=d(0);async function M(){try{const{data:l}=await f.from("products").select("*");w.value=l,B.value=l.length,j.value=l.filter(o=>o.stock<10).length;const{count:t}=await f.from("orders").select("*",{count:"exact"}).eq("status","в обработке");T.value=t}catch(l){console.error("Ошибка загрузки данных:",l)}}const z=Z(()=>w.value.filter(l=>{const t=l.name.toLowerCase().includes(C.value.toLowerCase())||l.description.toLowerCase().includes(C.value.toLowerCase()),o=!h.value||l.category===h.value;return t&&o})),k=d(!1),b=d(!1),O=d(null),e=Q({name:"",description:"",category:"",price:0,stock:0}),r=Q({name:"",category:"",price:"",stock:""}),A=()=>{let l=!0;return r.name=e.name.trim()?"":"Название обязательно",r.category=e.category?"":"Выберите категорию",r.price=e.price>0?"":"Цена должна быть больше 0",r.stock=e.stock>=0?"":"Неверное количество",l=!Object.values(r).some(t=>t),l},E=()=>{e.name="",e.description="",e.category="",e.price=0,e.stock=0,O.value=null,Object.keys(r).forEach(l=>r[l]="")},G=()=>{b.value=!1,E(),k.value=!0},H=l=>{b.value=!0,O.value=l.id,e.name=l.name,e.description=l.description,e.category=l.category,e.price=l.price,e.stock=l.stock,k.value=!0},_=()=>{k.value=!1,E()},I=async()=>{if(A())try{const l={name:e.name.trim(),description:e.description.trim(),category:e.category,price:parseFloat(e.price),stock:parseInt(e.stock)};if(b.value){const{error:t}=await f.from("products").update(l).eq("id",O.value);if(t)throw t}else{const{error:t}=await f.from("products").insert(l);if(t)throw t}await M(),_()}catch(l){console.error("Ошибка сохранения товара:",l),alert("Произошла ошибка при сохранении товара")}};async function J(l){try{const{error:t}=await f.from("products").delete().eq("id",l);if(t){console.error("Supabase error:",t),alert("Ошибка удаления: "+t.message);return}w.value=w.value.filter(o=>o.id!==l)}catch(t){console.error("General error:",t),alert("Неизвестная ошибка при удалении")}}ss(()=>{M()});const P=d(!1),y=d(null),q=d(1),V=d(""),K=d(1e3),R=l=>{y.value=l,P.value=!0},S=()=>{P.value=!1,W()},W=()=>{q.value=1,V.value=""},X=async()=>{try{if(!y.value)return;const{error:l}=await f.from("orders").insert([{product_id:y.value.id,quantity:q.value,comment:V.value,status:"в обработке"}]);if(l)throw l;await M(),S(),alert("Заказ успешно оформлен!")}catch(l){console.error("Ошибка оформления заказа:",l),alert("Произошла ошибка при оформлении заказа")}};return(l,t)=>(a(),i(g,null,[s("div",ts,[s("div",os,[s("div",es,[s("div",ls,[t[14]||(t[14]=s("h5",null,"Всего товаров",-1)),s("div",rs,n(B.value),1),t[15]||(t[15]=s("i",{class:"bi bi-boxes"},null,-1))])]),s("div",ns,[s("div",as,[t[16]||(t[16]=s("h5",null,"Активных заказов",-1)),s("div",is,n(T.value),1),t[17]||(t[17]=s("i",{class:"bi bi-truck"},null,-1))])]),s("div",ds,[s("div",us,[t[18]||(t[18]=s("h5",null,"Товары заканчиваются",-1)),s("div",cs,n(j.value),1),t[19]||(t[19]=s("i",{class:"bi bi-exclamation-triangle"},null,-1))])])]),s("div",vs,[s("div",ms,[u(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>C.value=o),placeholder:"Поиск товаров...",class:"search-input"},null,512),[[m,C.value]]),u(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>h.value=o),class:"filter-select"},[t[20]||(t[20]=s("option",{value:""},"Все категории",-1)),(a(!0),i(g,null,x(U.value,o=>(a(),i("option",{value:o,key:o},n(o),9,ps))),128))],512),[[D,h.value]])]),s("button",{onClick:G,class:"add-button"},t[21]||(t[21]=[s("i",{class:"bi bi-plus-lg"},null,-1),v(" Добавить товар ")]))]),s("div",bs,[(a(!0),i(g,null,x(z.value,o=>(a(),i("div",{key:o.id,class:"product-card"},[s("div",ys,[s("h3",null,n(o.name),1),s("span",fs,n(o.category),1)]),s("div",ks,[s("p",null,n(o.description),1),s("div",_s,[s("div",gs,[t[22]||(t[22]=s("i",{class:"bi bi-cash"},null,-1)),v(" "+n(o.price)+" ₽ ",1)]),s("div",{class:p(["stat-item",{"low-stock":o.stock<10}])},[t[23]||(t[23]=s("i",{class:"bi bi-box"},null,-1)),v(" "+n(o.stock)+" шт ",1)],2)])]),s("div",ws,[o.stock<10?(a(),i("button",{key:0,onClick:N=>R(o),class:"btn-order"},t[24]||(t[24]=[s("i",{class:"bi bi-cart-plus"},null,-1),v(" Заказать ")]),8,Cs)):c("",!0),s("button",{onClick:N=>H(o),class:"btn-edit"},t[25]||(t[25]=[s("i",{class:"bi bi-pencil"},null,-1)]),8,hs),s("button",{onClick:N=>J(o.id),class:"btn-delete"},t[26]||(t[26]=[s("i",{class:"bi bi-trash"},null,-1)]),8,qs)])]))),128))])]),(a(),F(L,{to:"body"},[P.value?(a(),i("div",Vs,[s("div",xs,[s("div",{class:"modal-header"},[t[27]||(t[27]=s("h3",null,"Оформление заказа",-1)),s("button",{onClick:S,class:"close-btn"},"×")]),s("div",Us,[y.value?(a(),i("div",Ms,[s("h4",null,n(y.value.name),1),s("p",null,"Текущий остаток: "+n(y.value.stock)+" шт",1)])):c("",!0),s("div",Os,[t[28]||(t[28]=s("label",null,"Количество для заказа:",-1)),u(s("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=o=>q.value=o),min:"1",class:"form-control",max:K.value},null,8,Ps),[[m,q.value]])]),s("div",Ss,[t[29]||(t[29]=s("label",null,"Комментарий:",-1)),u(s("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>V.value=o),class:"form-control",rows:"3",placeholder:"Дополнительная информация..."},null,512),[[m,V.value]])])]),s("div",{class:"modal-footer"},[s("button",{onClick:S,class:"btn btn-secondary"},"Отмена"),s("button",{onClick:X,class:"btn btn-primary"},"Подтвердить заказ")])])])):c("",!0)])),(a(),F(L,{to:"body"},[k.value?(a(),i("div",Fs,[s("div",Ds,[s("div",Ls,[s("h3",null,n(b.value?"Редактирование товара":"Новый товар"),1),s("button",{onClick:_,class:"close-btn"},"×")]),s("div",Bs,[s("form",{onSubmit:$(I,["prevent"])},[s("div",Ts,[t[30]||(t[30]=s("label",null,[v("Название "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>e.name=o),type:"text",required:"",class:p(["form-control",{invalid:r.name}])},null,2),[[m,e.name]]),r.name?(a(),i("div",js,n(r.name),1)):c("",!0)]),s("div",Es,[t[31]||(t[31]=s("label",null,"Описание",-1)),u(s("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>e.description=o),class:"form-control",rows:"3"},null,512),[[m,e.description]])]),s("div",Is,[t[33]||(t[33]=s("label",null,[v("Категория "),s("span",{class:"required"},"*")],-1)),u(s("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>e.category=o),required:"",class:p(["form-control",{invalid:r.category}])},[t[32]||(t[32]=s("option",{value:""},"Выберите категорию",-1)),(a(!0),i(g,null,x(U.value,o=>(a(),i("option",{value:o,key:o},n(o),9,Ns))),128))],2),[[D,e.category]]),r.category?(a(),i("div",Qs,n(r.category),1)):c("",!0)]),s("div",$s,[s("div",zs,[t[34]||(t[34]=s("label",null,[v("Цена "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>e.price=o),type:"number",min:"0",step:"0.01",required:"",class:p(["form-control",{invalid:r.price}])},null,2),[[m,e.price]]),r.price?(a(),i("div",As,n(r.price),1)):c("",!0)]),s("div",Gs,[t[35]||(t[35]=s("label",null,[v("Остаток "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>e.stock=o),type:"number",min:"0",required:"",class:p(["form-control",{invalid:r.stock}])},null,2),[[m,e.stock]]),r.stock?(a(),i("div",Hs,n(r.stock),1)):c("",!0)])]),s("div",Js,[s("button",{type:"button",onClick:_,class:"btn btn-secondary"}," Отмена "),s("button",Ks,n(b.value?"Сохранить изменения":"Добавить товар"),1)])],32)])])])):c("",!0)])),(a(),F(L,{to:"body"},[k.value?(a(),i("div",Rs,[s("div",Ws,[s("div",Xs,[s("h3",null,n(b.value?"Редактирование товара":"Новый товар"),1),s("button",{onClick:_,class:"close-btn"},"×")]),s("div",Ys,[s("form",{onSubmit:$(I,["prevent"])},[s("div",Zs,[t[36]||(t[36]=s("label",null,[v("Название "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>e.name=o),type:"text",required:"",class:p(["form-control",{invalid:r.name}])},null,2),[[m,e.name]]),r.name?(a(),i("div",st,n(r.name),1)):c("",!0)]),s("div",tt,[t[37]||(t[37]=s("label",null,"Описание",-1)),u(s("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>e.description=o),class:"form-control",rows:"3"},null,512),[[m,e.description]])]),s("div",ot,[t[39]||(t[39]=s("label",null,[v("Категория "),s("span",{class:"required"},"*")],-1)),u(s("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>e.category=o),required:"",class:p(["form-control",{invalid:r.category}])},[t[38]||(t[38]=s("option",{value:""},"Выберите категорию",-1)),(a(!0),i(g,null,x(U.value,o=>(a(),i("option",{value:o,key:o},n(o),9,et))),128))],2),[[D,e.category]]),r.category?(a(),i("div",lt,n(r.category),1)):c("",!0)]),s("div",rt,[s("div",nt,[t[40]||(t[40]=s("label",null,[v("Цена "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>e.price=o),type:"number",min:"0",step:"0.01",required:"",class:p(["form-control",{invalid:r.price}])},null,2),[[m,e.price]]),r.price?(a(),i("div",at,n(r.price),1)):c("",!0)]),s("div",it,[t[41]||(t[41]=s("label",null,[v("Остаток "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>e.stock=o),type:"number",min:"0",required:"",class:p(["form-control",{invalid:r.stock}])},null,2),[[m,e.stock]]),r.stock?(a(),i("div",dt,n(r.stock),1)):c("",!0)])]),s("div",ut,[s("button",{type:"button",onClick:_,class:"btn btn-secondary"}," Отмена "),s("button",ct,n(b.value?"Сохранить изменения":"Добавить товар"),1)])],32)])])])):c("",!0)]))],64))}},yt=Y(vt,[["__scopeId","data-v-972b86c3"]]);export{yt as default};
